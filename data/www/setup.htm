<html>

<head>
    <title>%esp_name%</title>
    <link href='css/main.css' rel='stylesheet' type='text/css' />
</head>

<body onload="SetFields()">
    <h1>%esp_name% settings</h1>
    <form name="setup" method="get" action="savesettings">
        <table>
            <col width="200">
            <col width="200">
            <tr>
                <td>WebLog Display Level</td>
                <td>
                    <select id="webloglevel" name="webloglevel">
                        <option value="0">none</option>
                        <option value="1">Error</option>
                        <option value="2">Warning</option>
                        <option value="3">Info</option>
                        <option value="4">Debug</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>ESP Board</td>
                <td>
                    <select id="esp_board" name="esp_board" onchange="ChangeBoard()">
                        <option value="none">none</option>
                        <option value="ESP_Wroom">ESP32_wroom</option>
                        <option value="M5stamp_pico">M5Stamp_pico</option>
                    </select>
                </td>
            </tr>
            
            <tr>
                <td>ESP name:</td>
                <td><input name="esp_name" maxlength="19" size="19" value="%esp_name%"></td>
            </tr>
            <tr>
                <td>Web Userid:</td>
                <td><input name="esp_uname" maxlength="9" size="9" value="%esp_uname%"></td>
            </tr>
            <tr>
                <td>Password:</td>
                <td><input name="esp_pass" maxlength="19" size="19" value="%esp_pass%"></td>
            </tr>
            <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
            <tr>
                <td>Network</td>
                <td>
                    <select id="IPsetting" name="IPsetting" onchange="ChangeIP()">
                        <option value="DHCP">DHCP</option>
                        <option value="Fixed">Fixed</option>
                    </select>
                </td>
            </tr>
            <tr id="IPaddr">
                <td>&nbsp;&nbsp;IP Address:</td>
                <td><input name="IPaddr" maxlength="15" size="15" value="%IPaddr%"></td>
            </tr>
            <tr id="SubNetMask">
                <td>&nbsp;&nbsp;Subnetmask:</td>
                <td><input name="SubNetMask" maxlength="4" size="15" value="%SubNetMask%"></td>
            </tr>
            <tr id="GatewayAddr">
                <td>&nbsp;&nbsp;Gateway Addr:</td>
                <td><input name="GatewayAddr" maxlength="15" size="15" value="%GatewayAddr%"></td>
            </tr>
            <tr id="DNSAddr">
                <td>&nbsp;&nbsp;DNS IPAddress:</td>
                <td><input name="DNSAddr" maxlength="15" size="15" value="%DNSAddr%"></td>
            </tr>
            <!--<tr height = 20px></tr>-->
            <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
            <tr>
                <td>RF transmit settings</td>
                <tr id="RF1">
                    <td>&nbsp;&nbsp;RF protocol:</td>
                    <td><input name="RFProtocol" maxlength="3" size="3" value="%RFProtocol%"></td>
                </tr>
                <tr id="RF2">
                    <td>&nbsp;&nbsp;RF pulse:</td>
                    <td><input name="RFPulse" maxlength="5" size="5" value="%RFPulse%"></td>
                </tr>
                <tr id="RF3">
                    <td>&nbsp;&nbsp;RF code (max 32bit):</td>
                    <td><input name="RFcode" maxlength="33" size="33" value="%RFcode%"></td>
                </tr>
            </tr>
            <td bgcolor="#FFFFFF" style="line-height:10px;" colspan=3>&nbsp;</td>
            <tr>
                <td>Send Protocol</td>
                <td>
                    <select id="Send_Protocol" name="Send_Protocol" onchange="ChangeProtocol()">
                        <option value="none">none</option>
                        <option value="json">json</option>
                        <option value="mqtt">mqtt</option>
                    </select>
                </td>
            </tr>
            <tr id="server1">
                <td>&nbsp;&nbsp;Server IP:</td>
                <td><input name="ServerIP" maxlength="15" size="15" value="%ServerIP%"></td>
            </tr>
            <tr id="server2">
                <td>&nbsp;&nbsp;Server Port:</td>
                <td><input name="ServerPort" maxlength="4" size="4" value="%ServerPort%"></td>
            </tr>
            <tr id="server3">
                <td>&nbsp;&nbsp;Server Userid:</td>
                <td><input name="ServerUser" maxlength="15" size="15" value="%ServerUser%"></td>
            </tr>
            <tr id="server4">
                <td>&nbsp;&nbsp;Server Password:</td>
                <td><input name="ServerPass" maxlength="15" size="15" value="%ServerPass%"></td>
            </tr>
            <tr id="server5">
                <td>&nbsp;&nbsp;Domoticz IDX:</td>
                <td><input name="DomoticzIDX" maxlength="4" size="4" value="%DomoticzIDX%"></td>
            </tr>
            <tr id="server6">
                <td>&nbsp;&nbsp;Send IDX OFF</td>
                <td>
                    <select id="SendOff" name="SendOff" onchange="ChangeSendOff()">
                        <option value="yes">yes</option>
                        <option value="no">no</option>
                    </select>
                </td>
            </tr>
            <tr id="mqtt1">
                <td>&nbsp;&nbsp;MQTT subscriber:</td>
                <td><input name="MQTTsubscriber" maxlength="20" size="20" value="%MQTTsubscriber%"></td>
            </tr>
            <tr id="mqtt2">
                <td>&nbsp;&nbsp;MQTT TopicIn:</td>
                <td><input name="MQTTtopicin" maxlength="20" size="20" value="%MQTTtopicin%"></td>
            </tr>
            <tr>
                <td colspan=2 id="message">
                </td>
            </tr>
            <tr>
                <td colspan=2>
                    <input type="submit" value="Save"  class="button">&nbsp;&nbsp;
                    <input type="button" onClick="window.location.href='/configdump';" value="backup conf" class="button" />&nbsp;&nbsp;
                    <input type="button" onClick="window.location.href='/configupdrequest';" value="load config"  class="button" />&nbsp;&nbsp;
                </td>
            </tr>
            <tr>
                <td><br><br></td>
            </tr>
            <tr>
                <td>Clear wifi credentails:</td>
            </tr>
            <tr>
                <td>(be carefull to use)
            </tr>
            <tr>
                <td><button type="button" onclick="window.location.href='/wificlear';">Clear wifi</button></td>
            </tr>
        </table>
    </form>
</body>

</html>

<script language="javascript" type="text/javascript">
    var webloglevel = "%webloglevel%";
    var esp_board = "%esp_board%";
    var IPsetting = "%IPsetting%";
    var SendProtocol = "%SendProtocol%";
    var SendOff = "%SendOff%";
    
    function ChangeIP() {
        IPsetting = document.getElementById('IPsetting').value;
        SetFields();
    }

    function ChangeBoard() {
        esp_board = document.getElementById('esp_board').value;
        SetFields();
    }
    
    function ChangeProtocol() {
        SendProtocol = document.getElementById('Send_Protocol').value;
        SetFields();
    }

    function ChangeSendOff() {
        SendOff = document.getElementById('SendOff').value;
        SetFields();
    }
    
    function SetFields() {
        if (webloglevel == "0")
            document.getElementById('webloglevel').getElementsByTagName('option')[0].selected = 'selected';
        else if (webloglevel == "1")
            document.getElementById('webloglevel').getElementsByTagName('option')[1].selected = 'selected';
        else if (webloglevel == "2")
            document.getElementById('webloglevel').getElementsByTagName('option')[2].selected = 'selected';
        else if (webloglevel == "3")
            document.getElementById('webloglevel').getElementsByTagName('option')[3].selected = 'selected';
        else
            document.getElementById('webloglevel').getElementsByTagName('option')[4].selected = 'selected';

        if (esp_board == "ESP_Wroom")
            document.getElementById('esp_board').getElementsByTagName('option')[1].selected = 'selected';
        else if (esp_board == "M5stamp_pico")
            document.getElementById('esp_board').getElementsByTagName('option')[2].selected = 'selected';
        else {
            document.getElementById('esp_board').getElementsByTagName('option')[0].selected = 'selected';
            document.getElementById("message").innerHTML = "<span style='color:red'><b> *** Select Esp-board Chime! ***</b></span>";
        }

        if (IPsetting == "Fixed") {
            document.getElementById('IPsetting').getElementsByTagName('option')[1].selected = 'selected';
            document.getElementById('IPaddr').style.display = '';
            document.getElementById('SubNetMask').style.display = '';
            document.getElementById('GatewayAddr').style.display = '';
            document.getElementById('DNSAddr').style.display = '';
        }
        else {
            document.getElementById('IPsetting').getElementsByTagName('option')[0].selected = 'selected';
            document.getElementById('IPaddr').style.display = 'none';
            document.getElementById('SubNetMask').style.display = 'none';
            document.getElementById('GatewayAddr').style.display = 'none';
            document.getElementById('DNSAddr').style.display = 'none';
        }

        if (SendProtocol == "none") {
            document.getElementById('Send_Protocol').getElementsByTagName('option')[0].selected = 'selected';
            document.getElementById('server1').style.display = 'none';
            document.getElementById('server2').style.display = 'none';
            document.getElementById('server3').style.display = 'none';
            document.getElementById('server4').style.display = 'none';
            document.getElementById('server5').style.display = 'none';
            document.getElementById('server6').style.display = 'none';
            document.getElementById('mqtt1').style.display = 'none';
            document.getElementById('mqtt2').style.display = 'none';
        }
        else if (SendProtocol == "json") {
            document.getElementById('Send_Protocol').getElementsByTagName('option')[1].selected = 'selected';
            document.getElementById('server1').style.display = '';
            document.getElementById('server2').style.display = '';
            if (!document.forms['setup']['ServerPort'].value == '8080')
                document.forms['setup']['ServerPort'].value = '8080';
            document.getElementById('server3').style.display = '';
            document.getElementById('server4').style.display = '';
            document.getElementById('server5').style.display = '';
            document.getElementById('server6').style.display = '';
            document.getElementById('mqtt1').style.display = 'none';
            document.getElementById('mqtt2').style.display = 'none';
        }
        else if (SendProtocol == "mqtt") {
            document.getElementById('Send_Protocol').getElementsByTagName('option')[2].selected = 'selected';
            document.getElementById('server1').style.display = '';
            document.getElementById('server2').style.display = '';
            if (!document.forms['setup']['ServerPort'].value == '1883')
                document.forms['setup']['ServerPort'].value = '1883';
            document.getElementById('server3').style.display = '';
            document.getElementById('server4').style.display = '';
            document.getElementById('server5').style.display = '';
            document.getElementById('server6').style.display = '';
            document.getElementById('mqtt1').style.display = '';
            document.getElementById('mqtt2').style.display = '';
        }

        if (SendOff == "yes") {
            document.getElementById('SendOff').getElementsByTagName('option')[0].selected = 'selected';
        }
        else {
            document.getElementById('SendOff').getElementsByTagName('option')[1].selected = 'selected';
        }
    }
</script>